include engine/ShaderPS.txt

uniform sampler2D colorTexture;
uniform sampler2D lightTexture;

uniform vec2 origin;
uniform float numSamples;
uniform float decayPerSample;
uniform float strength;

shader_in vec2 v_texcoord;

void main()
{
	vec2 p1 = origin;
	vec2 p2 = v_texcoord;

	vec2 p = p1;
	vec2 p_inc = (p2 - p1) / numSamples;

	vec3 accu = vec3(0.0);

	for (float i = 0.0; i < numSamples; ++i)
	{
		//accu *= decayPerSample;
		accu *= pow(0.9, length(p - origin));

		vec3 value = texture(lightTexture, p).rgb;
		
		accu += value;

		p += p_inc;
	}

	accu /= numSamples;

	vec4 color = texture(colorTexture, v_texcoord);

	color.rgb += accu * strength;

	shader_fragColor = color;
}