include engine/ShaderPS.txt
include engine/ShaderUtil.txt

shader_in vec3 v_position_object;
shader_in vec4 v_color;

uniform float maxDistance;
uniform float outputLinearColorSpace;

void main()
{
	// -- calculate opacity based on view distance

	float distance = length(v_position_object.xz);

	float opacity = v_color.a * saturate(1.0 - distance / 1.0);

	// -- calculate color

	vec3 color = v_color.rgb;

	// -- apply dither. this is a large improvement in quality in vr

    color.rgb += colorDither8ScreenSpace(gl_FragCoord.xy);

	// -- apply color space conversion

    if (outputLinearColorSpace != 0.0)
    {
        color = srgbToLinear(color);
    }

    // -- store

	//opacity = 0.0;
	//color.r = 1.0;

    shader_fragColor = vec4(color, opacity);
}
